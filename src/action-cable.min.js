/*! ng-cable - v0.1.0 (https://github.com/wazery/ngCable) */
(function(){this.Cable={PING_IDENTIFIER:"_ping",createConsumer:function(a){return new Cable.Consumer(a)}}}).call(this),function(){var a=[].slice,b=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};Cable.Connection=function(){function c(a){this.consumer=a,this.open()}return c.prototype.send=function(a){return this.isOpen()?(this.webSocket.send(JSON.stringify(a)),!0):!1},c.prototype.open=function(){return this.isState("open","connecting")?void 0:(this.webSocket=new WebSocket(this.consumer.url),this.installEventHandlers())},c.prototype.close=function(){var a;if(!this.isState("closed","closing"))return null!=(a=this.webSocket)?a.close():void 0},c.prototype.reopen=function(){return this.isOpen()?this.closeSilently(function(a){return function(){return a.open()}}(this)):this.open()},c.prototype.isOpen=function(){return this.isState("open")},c.prototype.isState=function(){var c,d;return d=1<=arguments.length?a.call(arguments,0):[],c=this.getState(),b.call(d,c)>=0},c.prototype.getState=function(){var a,b,c;for(b in WebSocket)if(c=WebSocket[b],c===(null!=(a=this.webSocket)?a.readyState:void 0))return b.toLowerCase();return null},c.prototype.closeSilently=function(a){null==a&&(a=function(){}),this.uninstallEventHandlers(),this.installEventHandler("close",a),this.installEventHandler("error",a);try{return this.webSocket.close()}finally{this.uninstallEventHandlers()}},c.prototype.installEventHandlers=function(){var a,b;b=[];for(a in this.events)b.push(this.installEventHandler(a));return b},c.prototype.installEventHandler=function(a,b){return null==b&&(b=this.events[a].bind(this)),this.webSocket.addEventListener(a,b)},c.prototype.uninstallEventHandlers=function(){var a,b;b=[];for(a in this.events)b.push(this.webSocket.removeEventListener(a));return b},c.prototype.events={message:function(a){var b,c,d;return d=JSON.parse(a.data),b=d.identifier,c=d.message,this.consumer.subscriptions.notify(b,"received",c)},open:function(){return this.consumer.subscriptions.reload()},close:function(){return this.consumer.subscriptions.notifyAll("disconnected")},error:function(){return this.consumer.subscriptions.notifyAll("disconnected"),this.closeSilently()}},c.prototype.toJSON=function(){return{state:this.getState()}},c}()}.call(this),function(){Cable.ConnectionMonitor=function(){function a(a){this.consumer=a,this.consumer.subscriptions.add(this),this.start()}var b,c,d;return a.prototype.identifier=Cable.PING_IDENTIFIER,a.prototype.pollInterval={min:2,max:30},a.prototype.staleThreshold={startedAt:4,pingedAt:8},a.prototype.connected=function(){return this.reset(),this.pingedAt=c()},a.prototype.received=function(){return this.pingedAt=c()},a.prototype.reset=function(){return this.reconnectAttempts=0},a.prototype.start=function(){return this.reset(),delete this.stoppedAt,this.startedAt=c(),this.poll()},a.prototype.stop=function(){return this.stoppedAt=c()},a.prototype.poll=function(){return setTimeout(function(a){return function(){return a.stoppedAt?void 0:(a.reconnectIfStale(),a.poll())}}(this),this.getInterval())},a.prototype.getInterval=function(){var a,c,d,e;return e=this.pollInterval,d=e.min,c=e.max,a=4*Math.log(this.reconnectAttempts+1),1e3*b(a,d,c)},a.prototype.reconnectIfStale=function(){return this.connectionIsStale()?(this.reconnectAttempts+=1,this.consumer.connection.reopen()):void 0},a.prototype.connectionIsStale=function(){return this.pingedAt?d(this.pingedAt)>this.staleThreshold.pingedAt:d(this.startedAt)>this.staleThreshold.startedAt},a.prototype.toJSON=function(){var a,b;return b=this.getInterval(),a=this.connectionIsStale(),{startedAt:this.startedAt,stoppedAt:this.stoppedAt,pingedAt:this.pingedAt,reconnectAttempts:this.reconnectAttempts,connectionIsStale:a,interval:b}},c=function(){return(new Date).getTime()},d=function(a){return(c()-a)/1e3},b=function(a,b,c){return Math.max(b,Math.min(c,a))},a}()}.call(this),function(){var a=[].slice;Cable.Subscriptions=function(){function b(a){this.consumer=a,this.subscriptions=[]}return b.prototype.create=function(a,b){var c,d;return c=a,d="object"==typeof c?c:{channel:c},new Cable.Subscription(this,d,b)},b.prototype.add=function(a){return this.subscriptions.push(a),this.notify(a,"initialized"),this.sendCommand(a,"subscribe")?this.notify(a,"connected"):void 0},b.prototype.reload=function(){var a,b,c,d,e;for(c=this.subscriptions,d=[],a=0,b=c.length;b>a;a++)e=c[a],this.sendCommand(e,"subscribe")?d.push(this.notify(e,"connected")):d.push(void 0);return d},b.prototype.remove=function(a){var b;return this.subscriptions=function(){var c,d,e,f;for(e=this.subscriptions,f=[],c=0,d=e.length;d>c;c++)b=e[c],b!==a&&f.push(b);return f}.call(this),this.findAll(a.identifier).length?void 0:this.sendCommand(a,"unsubscribe")},b.prototype.findAll=function(a){var b,c,d,e,f;for(d=this.subscriptions,e=[],b=0,c=d.length;c>b;b++)f=d[b],f.identifier===a&&e.push(f);return e},b.prototype.notifyAll=function(){var b,c,d,e,f,g,h;for(c=arguments[0],b=2<=arguments.length?a.call(arguments,1):[],f=this.subscriptions,g=[],d=0,e=f.length;e>d;d++)h=f[d],g.push(this.notify.apply(this,[h,c].concat(a.call(b))));return g},b.prototype.notify=function(){var b,c,d,e,f,g,h;for(g=arguments[0],c=arguments[1],b=3<=arguments.length?a.call(arguments,2):[],h="string"==typeof g?this.findAll(g):[g],f=[],d=0,e=h.length;e>d;d++)g=h[d],f.push("function"==typeof g[c]?g[c].apply(g,b):void 0);return f},b.prototype.sendCommand=function(a,b){var c;return c=a.identifier,c===Cable.PING_IDENTIFIER?this.consumer.connection.isOpen():this.consumer.send({command:b,identifier:c})},b.prototype.toJSON=function(){var a,b,c,d,e;for(c=this.subscriptions,d=[],a=0,b=c.length;b>a;a++)e=c[a],d.push(e.identifier);return d},b}()}.call(this),function(){Cable.Subscription=function(){function a(a,c,d){this.subscriptions=a,null==c&&(c={}),this.identifier=JSON.stringify(c),b(this,d),this.subscriptions.add(this),this.consumer=this.subscriptions.consumer}var b;return a.prototype.perform=function(a,b){return null==b&&(b={}),b.action=a,this.send(b)},a.prototype.send=function(a){return this.consumer.send({command:"message",identifier:this.identifier,data:JSON.stringify(a)})},a.prototype.unsubscribe=function(){return this.subscriptions.remove(this)},b=function(a,b){var c,d;if(null!=b)for(c in b)d=b[c],a[c]=d;return a},a}()}.call(this),function(){Cable.Consumer=function(){function a(a){this.url=a,this.subscriptions=new Cable.Subscriptions(this),this.connection=new Cable.Connection(this),this.connectionMonitor=new Cable.ConnectionMonitor(this)}return a.prototype.send=function(a){return this.connection.send(a)},a.prototype.inspect=function(){return JSON.stringify(this,null,2)},a.prototype.toJSON=function(){return{url:this.url,subscriptions:this.subscriptions,connection:this.connection,connectionMonitor:this.connectionMonitor}},a}()}.call(this);